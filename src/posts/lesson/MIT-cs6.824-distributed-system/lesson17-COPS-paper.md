---
category: 
  - 分布式系统
tag:
  - 分布式系统
---

# 不要满足于最终一致性：使用 COPS 实现广域存储的可扩展因果一致性

## 摘要

支持复杂在线应用（如社交网络）的地理复制分布式数据存储必须提供一种 "始终在线" 的体验，即操作始终以低延迟完成。如今的系统通常会牺牲强一致性来实现这些目标，向其客户端暴露不一致性，并需要复杂的应用逻辑。在本文中，我们识别并定义了一种一致性模型 —— 具有收敛冲突处理的因果一致性，即 causal+，这是在这些约束下所能实现的最强一致性。

我们展示了 COPS 的设计与实现，COPS 是一个键值存储，它在广域范围内提供这种一致性模型。COPS 的一个关键贡献是其可扩展性，它可以在整个集群中存储的键之间强制执行因果依赖关系，而不像以前的系统那样只在单个服务器上执行。COPS 的核心方法是在暴露写入之前，跟踪并明确检查本地集群中键之间的因果依赖关系是否得到满足。此外，在 COPS-GT 中，我们引入了获取事务，以便在不锁定或阻塞的情况下获得多个键的一致视图。我们的评估表明，COPS 在不到一毫秒的时间内完成操作，在每个集群使用一个服务器时提供与以前系统类似的吞吐量，并且随着我们增加每个集群中的服务器数量而具有良好的扩展性。它还表明，对于常见工作负载，COPS-GT 在延迟、吞吐量和扩展性方面与 COPS 类似。

### 1. 引言

分布式数据存储是现代互联网服务的基础构建块。理想情况下，这些数据存储应该具备以下特性：**强一致性**（strong consistency）、**对读写操作始终可用**（always available for reads and writes）、以及在**网络分区**（network partitions）期间能够继续运行。然而，CAP 定理明确证明，不可能创建一个同时满足这三种特性的系统。

因此，现代 Web 服务普遍选择在牺牲强一致性的前提下，优先实现 **可用性**（availability）和 **分区容忍性**（partition tolerance）。考虑到这种选择还能使系统提供低延迟的客户端操作和高可扩展性，这一取舍并不令人意外。此外，许多早期的大规模互联网服务（例如专注于 Web 搜索的系统）通常对强一致性没有太高要求。然而，随着互动性更强的服务（例如社交网络应用）的兴起，这种情况正在发生变化。

我们将具有以下四个特性的系统称为 ALPS 系统:
- Availability(即可用性)
- low Latency(低延迟)
- Partition-tolerance(分区容忍性)
- high Scalability(高可扩展性)

由于 ALPS 系统必须牺牲强一致性（例如线性一致性），我们希望在这种约束下实现最强的可用一致性模型。更强的一致性是可取的，因为它使程序员更容易理解和使用系统。在本文中，我们考虑了具有收敛冲突处理的因果一致性，我们将其称为 causal+ 一致性。许多之前被认为实现了较弱因果一致性的系统实际上实现了更有用的 causal+ 一致性，但没有一个系统以可扩展的方式实现它。

Causal+ 一致性中的因果一致性组件确保数据存储遵守操作之间的因果依赖关系。例如，假设一个用户将图片上传到网站，图片被保存后，又向该用户的相册中添加了一条指向该图片的引用。这种引用"依赖于"图片的保存。在 causal+ 一致性下，这些依赖关系始终能够得到满足。程序员不需要处理类似于弱一致性系统（如最终一致性）中可能遇到的情况，即可能获取到图片的引用但无法获取图片本身。

收敛冲突处理组件确保副本不会永久分歧，并且对同一键的冲突更新在所有站点以相同方式处理。当结合因果一致性时，该属性还确保客户端只会看到不断更新的键版本。相比之下，最终一致性系统可能会暴露乱序版本。通过将因果一致性与收敛冲突处理相结合，causal+ 一致性确保了客户端能够看到一个因果正确、无冲突且始终前进的数据存储。



## ps

线性一致性 顺序一致性

https://www.codedump.info/post/20220710-weekly-22/#%E9%A1%BA%E5%BA%8F%E4%B8%80%E8%87%B4%E6%80%A7