---
category: 
- 计算机架构
tag:
- 计算机架构
---

- [计算机基本架构-系统总线](#计算机基本架构-系统总线)
  - [并行总线架构](#并行总线架构)
  - [基本写传输过程](#基本写传输过程)
  - [基本读传输过程](#基本读传输过程)
  - [总线主状态改变](#总线主状态改变)
  - [总线握手](#总线握手)
  - [总线仲裁](#总线仲裁)
  - [串行接口](#串行接口)

# 计算机基本架构-系统总线

系统总线负责维护中央处理器(CPU)、系统外设和内存之间的所有通信。系统总线按照一定的总线协议运行，以在总线主控设备和总线从属设备之间交换数据。总线协议确保在总线主控设备与总线从属设备交换数据时，将所有其他系统设备隔离开，以免干扰总线。总线主控设备发起数据传输，发送或接收来自从属设备或系统内存的数据。另一方面，总线从属设备没有启动数据传输的能力，只能响应总线主控设备以交换数据。

总线架构有两种类型，**串行总线**和**并行总线**。**串行总线**架构基本上由主控设备和从属设备之间的一根数据线组成，数据位一次一位地交换。相反， **并行总线**由多根数据线组成，可以同时发送或接收多个数据位。

在本章中，我们将描述几种串行和并行总线协议以及优先级方案。

## 并行总线架构

典型系统中有两种并行总线架构：单向总线和双向总线。单向总线包含两条独立的数据路径：一条从总线主控设备开始到总线从属设备结束，另一条从总线从属设备开始到总线主控设备结束。而双向总线共享一条物理数据路径，允许数据在两个方向上流动。然而，这种类型的总线需要额外的逻辑开销和更复杂的控制。

下图描述了一种**32位单向总线架构**，包括两个总线主控设备和三个从属设备。在该图中，两条单向数据路径用较粗的线条突出显示。第一条路径是**写路径**，总线主控设备使用该路径将数据写入从属设备。此路径需要每个主控设备和从属设备都有一个写数据端口（```WData```）。第二条路径是**读路径**，用于从从属设备读取数据。这也需要每个主控设备和从属设备都有一个读数据端口（```RData```）。总线主控设备和从属设备都具有地址和控制端口，用于定义目标地址、数据传输方向、数据宽度和数据传输长度。

所有总线主控设备在开始数据传输之前必须与总线仲裁器协商以获得总线的所有权。当有多个总线主控设备的请求待处理时，仲裁器会根据某种优先级方案决定哪个总线主控设备应该优先开始数据传输，并向优先级最高的主控设备发出确认信号。因此，每个总线主控设备都有请求（Req）和确认（Ack）端口与仲裁器进行通信。一旦获得许可，主控设备会在第一个总线周期内向选定的从属设备发送地址和控制信号，并在下一个周期内写入或读取数据。连接到地址总线的解码器（DEC）会生成使能（EN）信号来激活选定的从属设备。每个主控设备和从属设备都有一个准备状态(ready)的端口，指示选定的从属设备是否准备好传输或接收数据。

![两主三从的总线结构的示例](https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/computer-base/Fundamentals-of-Computer-Architecture-and-Design/4/bus-structure-two-masters-three-slaves.png)

**32位双向总线架构**如下图所示。为了便于比较，主设备和从设备的数量与上图保持一致。两图之间唯一的区别是，早期架构中的单向数据总线被双向总线所取代，用于读写数据。在双向总线架构中，数据线上的三态缓冲器是必不可少的，它们可以在数据传输仅在主设备和从设备之间进行时，隔离非必要的系统设备。图中的地址总线也可以与数据总线集成，以便在同一条总线上交换地址和数据。然而，这种方案速度较慢，并且需要额外的控制逻辑开销来维护正确的数据流和管理。

![两主三从的双向总线结构的示例](https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/computer-base/Fundamentals-of-Computer-Architecture-and-Design/4/bidirectional-bus-structure-with-two-bus-masters-and-three-slaves.png)


下面这张图展示了典型总线主设备的所有输入/输出（I/O）端口。正如前面提到的，```Req```和```Ack```端口用于与仲裁器进行通信。总线主设备使用```Ready```端口来确定从设备是否准备好传输或接收数据。```WData```、```RData```和```Address```端口分别用于写入数据、读取数据和指定从设备地址。控制信号```Status```、```Write```、```Size```和```Burst```描述了数据传输的性质。

![总线主设备接口](https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/computer-base/Fundamentals-of-Computer-Architecture-and-Design/4/Bus-master-interface.png)

```Status```端口是一个两位总线，如下表所示，用于描述总线主设备的状态。根据该表，总线主设备可以通过发出```START```信号来启动新的数据传输。如果主设备正在与从设备交换数据，则会发出```Continue``` (CONT)信号。```IDLE```信号表示总线主设备已经完成了数据传输。一旦产生该信号，主设备会继续发出当前数据传输的最后一个地址和控制信号，直到总线上出现新的数据传输。总线主设备在与从设备交换数据的同时，也可能正在进行内部操作。对于这种特定情况，主设备可能会通过发出```BUSY```信号来暂时中止数据传输。

|```Status[1：0]```|总线主设备的状态|
|--|--|
|0 0|开始传输(START)|
|0 1|继续传输(CONT)|
|1 0|完成传输(IDLE)|
|1 1|停止传输(BUSY)|

Write端口，顾名思义，用于描述主设备是否正在进行数据写入或读取，如下表所示：

|```Write```|总线主设备的操作|
|--|--|
|0|读|
|1|写|

```Size```端口描述了传输过程中数据的位宽，如下表所示。总线主设备可以以8位（字节）、16位（半字）、32位（字）或64位（双字）的形式传输或接收数据，位宽在传输过程中不可更改：

|```Size[1：0]```|比特数|
|--|--|
|0 0|8|
|0 1|16|
|1 0|32|
|1 1|64|

```Burst```端口描述了总线主设备发送或接收的数据包数量，如下表所示。在该表中，总线主设备可以在一次突发传输中传输从一个数据包到超过32,000个数据包的数据。

|```Burst[3:0]```|数据包数量|
|--|--|
|0 0 0 0|1|
|0 0 0 1|2|
|0 0 1 0|4|
|0 0 1 1|8|
|0 1 0 0|16|
|0 1 0 1|32|
|0 1 1 0|64|
|0 1 1 1|128|
|1 0 0 0|256|
|1 0 0 1|512|
|1 0 1 0|1024|
|1 0 1 1|2048|
|1 1 0 0|4096|
|1 1 0 1|8196|
|1 1 1 0|16384|
|1 1 1 1|32768|


下图显示了一个典型的总线从设备的I/O端口。由于从设备无权发起数据传输，因此省略了```Req```和```Ack```端口。```Ready```信号指示一旦总线主设备发起传输，从设备是否准备好传输或接收数据。WData、RData和Address端口分别用于写数据、读数据和指定目的地址。控制输入```Status```、```Write```、```Size```和```Burst```描述了上述传输的性质。```Enable```（EN）输入由地址解码器生成，并基于总线主设备生成的地址来激活特定的从设备。

![总线从设备接口](https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/computer-base/Fundamentals-of-Computer-Architecture-and-Design/4/Bus-slave-interface.png)

## 基本写传输过程

这一节中，我们将使用时序图作为标准工具，展示主设备与从设备之间的总线活动。写操作的总线协议描述了总线主控设备如何使用单向总线将数据写入从属设备，具体过程由图中的时序图展示。

贴图

在第一个时钟周期，总线主控设备向从属设备发送目标地址和控制信号，```A1```和```C1```，而不管从属设备的状态如何。如果从属设备的状态是准备好（Ready），实际数据包```WData1```将在第二个周期与下一个数据包的地址和控制信号```A2```和```C2```一起发送。如果从属设备准备好，它应能在第三个时钟周期的上升沿读取```WData1```。然而，有时从属设备可能未准备好接收或发送数据。比如，在下图的第二个周期，从属设备的状态变为未准备好（Not Ready）。在第三个时钟周期的上升沿检测到从属设备的状态后，主控设备暂停写传输。这意味着当前的数据包```WData2```及下一个地址和控制信号A3和C3将被重复发送，直到从属设备的状态变为准备好为止。当从属设备准备好接收剩余数据时，正常的数据传输将继续。

## 基本读传输过程

## 总线主状态改变

## 总线握手

## 总线仲裁

## 串行接口

