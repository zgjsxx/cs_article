---
category: 
- 计算机架构
tag:
- 计算机架构
---

- [计算机基本架构-内存](#计算机基本架构-内存)
  - [1.静态随机存取存储器 (SRAM)](#1静态随机存取存储器-sram)
  - [2.同步动态随机存取存储器（SDRAM）](#2同步动态随机存取存储器sdram)
  - [3.电可擦除可编程只读存储器(EEPROM)](#3电可擦除可编程只读存储器eeprom)
  - [4.Flash memory](#4flash-memory)
  - [refernce](#refernce)

# 计算机基本架构-内存

先前的章节解释了基本的串行和并行总线结构，以及总线主控器和从设备之间不同形式的数据传输。无论总线架构如何，总线主控器被定义为发起数据传输的逻辑块，而从设备被定义为只能在主控器要求下监听和交换数据的设备。然而，这两个设备都包含某种形式的存储器。在从设备的情况下，这可以是系统存储器或属于外设设备的缓冲存储器。

根据读取和写入速度、容量和数据的持久性，系统存储器和外设缓冲区可以分为三种不同的形式。如果需要快速的读写时间，则使用静态随机存取存储器 (```SRAM```)，尽管与其他类型的存储器相比，其单元尺寸相对较大。```SRAM``` 通常用于存储小的临时数据，并且通常连接到系统中的高速并行总线。如果需要大量存储，但可以容忍较慢的读写速度，那么动态随机存取存储器 (```DRAM```) 应该是主要使用的存储类型。```DRAM``` 仍然连接到高速并行总线，通常以接收或传送数据突发的方式运行。典型的 ```DRAM``` 单元比 ```SRAM``` 单元小得多，功耗也显著降低。```DRAM``` 的主要缺点是高数据读写延迟、存储控制和数据管理的复杂性。

数据的永久性存储需要第三种存储器类型，其单元类型由双栅金属氧化物半导体（MOS）晶体管组成。数据被永久性地存储在该设备的浮动栅中，直到被新数据覆写。电可擦可编程只读存储器（${E}^{2}PROM$）或闪存记忆体属于这种类型的设备。这种存储器类型的优点是，即使系统断电，它仍然保留存储的数据。然而，与所有其他存储器类型相比，这种存储器速度最慢，并且受到有限的读写周期限制。因此，它的最佳用途是用于存储内建操作系统（```BIOS```）的永久数据，特别是在功耗关键的手持设备中。典型的计算系统可以根据使用和应用软件的需要包含一种或全部三种类型的存储器。

本章中描述的```SDRAM```、```EEPROM```和```Flash```存储器的基本功能灵感来源于东芝存储器数据表[1-6]。较新的带SPI接口的串行Flash存储器则基于Atmel Flash存储器的数据表[7]。在每种情况下，存储块的功能相较于原始数据表已经被大幅简化（并修改），以提高读者对相关主题的理解。这里的目的是展示每种存储器类型在系统中的操作方式，仅涵盖基本的操作模式，以便训练读者，而不是详细探讨实际数据表的内容。每种存储器的地址、数据和控制时序限制也较数据表进行了简化。这使我们能够轻松地为每种存储器类型设计总线接口。为了简化起见，我们避免了重复端口名称、确切的时序要求和功能细节，这些都可以在实际数据表中找到。读完本章后，建议有兴趣的读者在进行设计任务之前先研究参考数据表。

## 1.静态随机存取存储器 (SRAM)

静态随机存取存储器（```SRAM```）是数字设计中最基础的存储块之一。在各种类型的存储器中，```SRAM```速度最快。然而，其较大的存储单元尺寸限制了它在多种应用中的使用。

如图下图所示，典型的```SRAM```架构由四个不同的模块组成：**SRAM核心**、**地址译码器**、**感应放大器**和**内部SRAM控制器**。存储核心保持即时数据。感应放大器在读取过程中将单元电压放大到完整的逻辑电平。地址译码器根据N位地址生成${2}^{N}$个字线（Word Lines）。最后，控制器生成在读取或写入周期中所需的自时序脉冲。

![一个典型的有8比特地址和32比特数据位的SRAM架构](https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/computer-base/Fundamentals-of-Computer-Architecture-and-Design/5/SRAM-arhi-with-eight-bit-address-32-bit-data.png)

每个```SRAM```单元由两个背对背的反相器组成，就像锁存器中使用的那样，并且有两个N沟道金属氧化物半导体（NMOS）传输门晶体管来隔离单元中的现有数据或允许新数据进入单元，如下图所示。当需要将数据写入单元时，```WL = 1```会打开两个NMOS晶体管，允许来自Bit和Bitbar输入端的真实数据和互补数据同时写入单元。如果我们假设节点A初始为逻辑0，节点B为逻辑1，且WL = 0，那么WL的逻辑电平会关闭两个NMOS晶体管，锁存器将完全与其周围环境隔离。结果是逻辑0电平被保持在单元中。但是，如果```WL = 1```，Bit节点为1，Bitbar节点为0，那么WL的逻辑电平会打开两个NMOS晶体管，允许Bit和Bitbar上的值覆盖节点A和B上现有的逻辑电平，从而将单元中存储的位从逻辑0更改为逻辑1。

同样地，如果需要从单元中读取数据，可以通过设置```WL=1```来打开两个NMOS晶体管，然后在Bit和Bitbar输出之间产生的小差分电位会被感应放大器放大，最终在SRAM输出端达到完整的逻辑电平。

![SRAM内存单元](https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/computer-base/Fundamentals-of-Computer-Architecture-and-Design/5/SRAM-memory-cell.png)

数据写入序列以```EN= 1```和```WE = 1```开始。这种组合将SRAM核心中的```Bit```和```Bitbar```节点预充到预设电压值，并为写入做准备。当预充周期完成后，控制器通过设置```EnWL = 1```来启用地址解码器，如下图所示。解码器根据```AddrIn[7:0]```提供的值激活256个```WL```中的一个。在同一时间段内，控制器还生成```WritePulse = 1```，允许有效数据```DIn[31:0]```写入指定地址。

从SRAM核心读取数据通过设置```EN = 1```和```WE = 0```来执行。与写入操作类似，控制器在读取数据之前首先对SRAM核心进行预充，然后启用地址解码器。根据```AddrIn```端口的地址值，特定行的```WL```输入被激活，数据从指定行的每个单元被读取到相应的Bit和Bitbar节点。感应放大器将单元电压放大到全逻辑电平，并将数据传送到```DOut```端口。

贴图

将SRAM模块集成到现有系统中的一个重要任务是设计其总线接口。下图显示了这种实现的框图。总线接口基本上将所有总线控制信号转换为SRAM控制信号（反之亦然），但很少对地址或数据进行修改。在第4章描述的单向总线协议中，SRAM被视为总线从设备，它根据```Ready```信号与总线主设备交换数据。同样如**系统总线章节**中所述，总线主设备有四个控制信号来配置数据传输。```Status```信号指示总线主设备是发送第一个数据包（START）还是正在发送剩余的数据包（```CONT```）。总线主设备还可能发送```IDLE```或```BUSY```信号，分别指示其已完成当前数据传输或正忙于内部任务。```Write```信号指定总线主设备是打算向从设备写入数据还是从从设备读取数据。```Burst```信号指定事务中的数据包数量，而```Size```信号定义数据的宽度。

![图5-5：SRAM总线接口](https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/computer-base/Fundamentals-of-Computer-Architecture-and-Design/5/sram-bus-interface.png)

下图中的时序图展示了如何将四个数据包W1至W4写入四个连续的SRAM地址A1至A4。要启动写入序列，总线主设备在第一个时钟周期内发出一个有效地址，并设定```Status = START```和```Write = 1```，同时通过产生一个有效高的总线接口写入使能信号（```BIWEn```, Bus Interface Write Enable）来启用总线接口进行写入。在接收到```BIWEn = 1```后，总线接口在下一个周期内产生```Ready = 1```，并提示总线主设备在第三个周期内更改地址和控制信号。当总线主设备将地址从```A1```更改为```A2```时，它也根据第4章中解释的单向总线协议发送第一个数据包```W1```。然而，为了写入SRAM地址，有效数据必须与有效地址在同一个周期内可用，如图5-3所示。因此，在图5-5中，SRAM的Addr端口上添加了一组八个触发器，使地址A1延迟一个时钟周期，并与当前数据W1对齐。总线接口还在第三个周期内产生```EN = WE = 1```，以便在第四个时钟周期的正沿将```W1```写入```A1```。接下来的写入以相同的方式完成：SRAM地址延迟一个周期，以便在第五个周期的正沿将W2写入地址A2。在第六个周期，总线接口降低```Ready```信号，以使总线主设备停止递增从设备地址。然而，它保持```EN = WE = 1```，以便能够将```W4```写入```A4```。

贴图

为了启动读取序列，总线主设备在图5-8的第一个时钟周期内发出一个有效的SRAM地址，并设定```Status = START```和```Write = 0```信号。这种组合产生一个有效高的总线接口读使能信号，即```BIREn = 1```，这被解释为总线主设备打算从SRAM地址读取数据。因此，总线接口在第二个周期内产生```EN = 1```，```WE = 0```，```Ready = 1```。这在第三个周期从SRAM地址B1获取第一个数据R1。第四和第五周期内的读事务与第三周期相同，总线主设备分别从地址B2和B3读取数据R2和R3。在第六个周期，总线接口保持Ready = 1，以便总线主设备仍能够从地址B4读取最后一个数据R4。

贴图

增加SRAM容量需要使用额外的地址位。在图5-10所示的示例中，通过添加两个额外的地址位```Addr[5:4]```，SRAM容量从```32 x 16```位增加到```32 x 64```位，这些地址位用于访问四个SRAM块中的一个。在这个图中，即使```Addr[3:0]```指向所有四个32 x 16 SRAM块的相同地址位置，```Addr[5:4]```结合EN信号只启用四个块中的一个。此外，从所选块读取的数据通过```Addr[5:4]```输入路由到4-1多路复用器。```Addr[5:4] = 00```选择```DOut0```端口的内容，并通过4-1多路复用器的端口0将数据路由到Out[31:0]。同样，```Addr[5:4]``` = 01、10和11分别选择4-1多路复用器的端口1、2和3，并将```DOut1```、```DOut2```和```DOut3```端口的数据分别路由到```Out[31:0]```。

![图5-10：SRAM总线接口](https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/computer-base/Fundamentals-of-Computer-Architecture-and-Design/5/5-10-increasing-SRAM-address-space.png)


## 2.同步动态随机存取存储器（SDRAM）

**同步动态随机存取内存**(SDRAM) 是一种旧版 DRAM 的变种，它构成了几乎所有计算系统的主要内存。尽管它的容量可以比 SRAM 高出几个数量级，但它的速度却不如 SRAM。因此，SDRAM 主要用于在速度不重要的情况下存储大量数据块。

一个```SDRAM```模块由四个部分组成。存储核心是数据存储的地方。行和列解码器定位数据。感应放大器在读取过程中放大单元电压。控制器管理所有读写序列。

图5-11中的框图显示了一个典型的32位```SDRAM```架构，它由四个称为```bank```的存储核心组成，这些核心通过一个单向输入/输出端口访问。在操作内存之前，必须将主要的内部功能，如寻址模式、数据延迟和突发长度，存储在地址模式寄存器中。

贴图

编程完成后，如表5-1所示，低电平有效的行地址选通信号（```RAS```）、列地址选通信号（```CAS```）和写使能信号（```WE```）决定了内存的功能。选定银行的输入/输出端口上的数据可以在到达数据输入/输出端口（```DInOut```）之前在读/写逻辑块处被屏蔽。

![表5-1：SDRAM操作模式](https://raw.githubusercontent.com/zgjsxx/static-img-repo/main/blog/computer-base/Fundamentals-of-Computer-Architecture-and-Design/5/table5-1-SDRAM-modes-of-operation.png)

```SDRAM```单元是一个简单的器件，由一个```NMOS```通道晶体管来控制数据的流入和流出，以及一个电容器来存储数据，如图5-12所示。当需要将新数据写入单元时，通过将控制信号设置为1来打开NMOS晶体管，使```DIn/Out```端子的数据显示覆盖单元节点上的旧数据。另一方面，读取单元中的数据则需要在打开通道晶体管之前激活感应放大器。当需要保存数据时，只需通过将控制信号设置为0来关闭```NMOS```晶体管。然而，单元电容器上的电荷会通过其绝缘体慢慢泄漏，导致单元电压降低。因此，在```SDRAM```操作过程中，需要自动或手动的单元刷新周期来保持单元中的位值。

贴图


## 3.电可擦除可编程只读存储器(EEPROM)

## 4.Flash memory

## refernce

1. Toshiba datasheet TC59S6416/08/04BFT/BFTL-80, -10 Synchronous Dynamic RAM
2. Toshiba datasheet TC58DVM72A1FT00/TC58DVM72F1FT00 128Mbit E2PROM
3. Toshiba datasheet TC58256AFT 256Mbit E2PROM
4. Toshiba datasheet TC58FVT004/B004FT-85, -10, -12 4MBit CMOS Flash memory
5. Toshiba datasheet TC58FVT400/B400F/FT-85, -10, -12 4MBit CMOS Flash memory
6. Toshiba datasheet TC58FVT641/B641FT/XB-70, -10 64MBit CMOS Flash memory
7. Atmel datasheet AT26DF161 16Mbit serial data Flash memory

